# java_tzdb.dat_neta 機能ドキュメント

## 概要
`java_tzdb.dat_neta` は、Windows Forms を使用したアプリケーションで、javaのバイナリタイムゾーンデータベース (`tzdb.dat`) を解析し、指定されたタイムゾーンにおけるローカル時刻やオフセット情報を表示するツールです。
ユーザーはタイムゾーンを選択し、特定の日時に対する時刻変換や、タイムゾーンの遷移ルールを確認できます。

## 主な機能

### 1. タイムゾーンデータの読み込みと解析
- **対象ファイル**: `tzdb.dat`
- **動作**:  
  - アプリケーション起動時に `tzdb.dat` を読み込み、タイムゾーン、地域、エイリアス、ルールなどの情報を抽出。
  - バイナリデータを解析し、`regionArray`（地域リスト）、`ruleArray`（ルールデータ）、`aliases`（エイリアス辞書）などに格納。
- **表示**: 解析結果を `textBox1`（地域情報）と `textBox2`（エイリアス情報）に表示。

### 2. タイムゾーン情報の表示
- **入力**: ユーザーが `tzdb_names` テキストボックスにタイムゾーン名（例: `America/Los_Angeles`）を入力。
- **動作**:  
  - 指定されたタイムゾーンの標準オフセット（`StdOffsets`）、夏時間遷移（`SavTrans`/`SavOffsets`）、およびルール（`Rules`）を取得。
  - オフセットや遷移時刻を人間が読める形式（UTC または時:分）に変換して表示。
- **表示**: `textBox3` に詳細なタイムゾーン情報（遷移時刻、オフセット、ルールなど）を出力。

### 3. 特定日時のローカル時刻計算
- **入力**:  
  - `test_datetime` テキストボックスに日時（例: `2025-04-09 12:00:00`）を入力（未入力の場合は現在時刻を使用）。
  - `tzdb_names` で選択したタイムゾーン。
- **動作**:  
  - 指定日時を Unix タイムスタンプに変換し、タイムゾーンのオフセットを適用。
  - 夏時間（DST）の適用状況を考慮し、ローカル時刻を計算。
- **表示**: `time_date` テキストボックスに結果（例: `2025-04-09T12:00:00-07:00`）を表示。

### 4. 夏時間（DST）ルールの適用
- **動作**:  
  - `ZoneOffsetTransitionRule` を使用して、指定タイムゾーンの夏時間ルールを解析。
  - 年間ルール（例: 3 月第 2 日曜日に DST 開始）を基に、指定年における遷移時刻を計算。
- **オプション**: `comboBox1` で計算対象の年数を選択可能（デフォルトは 2 年間）。
- **表示**: `textBox3` に最近の遷移情報（UTC と Wall 時刻）を追加表示。

### 5. POSIX 形式の擬似ルール生成
- **動作**:  
  - 夏時間ルールから POSIX 形式（例: `STD-08:00DST-07:00,M3.2.0/02:00,M11.1.0/02:00`）に似た文字列を生成。
  - Java のバイナリルールを POSIX 風に変換した簡易表現として提供。
- **表示**: `textBox3` に `#java has no regular posix` コメントと共に表示。

### 6. UI と設定の永続化
- **UI コンポーネント**:  
  - `button1`: タイムゾーンデータの読み込みと解析を実行。
  - `button2`: 指定タイムゾーンの詳細情報と時刻計算を実行。
  - `div3600` チェックボックス: オフセットを秒単位ではなく時間単位で表示。
  - `ap_rules` チェックボックス: ルール適用時の挙動を制御（詳細不明）。
- **設定保存**: `Properties.Settings` を使用して、入力されたタイムゾーン名や日時を保存し、次回起動時に復元。

## 使用方法

### アプリケーション起動
- `WinFormsApp3.exe` を実行。
- 前回の設定（タイムゾーン名、日時）が自動的に読み込まれる。

### タイムゾーン選択
- `tzdb_names` にタイムゾーン名（例: `PST` や `America/New_York`）を入力。
- 短縮名（例: `PST`）は `ShortIds` 辞書で対応する完全名に変換。

### データ解析
- `button1` をクリックして `tzdb.dat` を解析。
- `textBox1` と `textBox2` に地域とエイリアス情報が表示される。

### 時刻計算
- `test_datetime` に日時を入力（オプション）。
- `button2` をクリックして選択したタイムゾーンの詳細とローカル時刻を表示。
- `time_date` に計算結果、`textBox3` に遷移情報が表示される。

## 注意点
- **依存ファイル**: `tzdb.dat` が同一ディレクトリに存在しない場合、エラーが発生。
- **エラー処理**: 例外が発生した場合、メッセージが表示されるが、詳細なデバッグ情報は限定的。
- **制限**: 一部の機能（例: `GetOffsets` の完全実装）は未完成または仮実装状態。

## 技術的詳細
- **使用言語**: C#（.NET Framework）
- **主要クラス**:  
  - `Form1`: メイン UI とロジック。
  - `ZoneInfoReader`: タイムゾーンデータのバイナリ解析。
  - `ZoneInfos`: Java の `ZoneInfo` に似たタイムゾーン情報管理。
- **依存ライブラリ**: `System.Buffers.Binary`, `System.Text.RegularExpressions` など。
